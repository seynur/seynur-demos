# =============================================================================
# ML SIDECAR — MASTER CONFIGURATION FILE
# =============================================================================
# This file defines:
#   - Model directory / name
#   - Splunk ingestion settings
#   - Modeling parameters
#   - Output destinations (Splunk KVStore)
#
# NOTES:
#   • Do NOT check real Splunk tokens into Git. Use environment variables instead.
#   • Time ranges follow Splunk syntax (e.g., -24h, -30d, now)
#   • All paths are relative to the ml_sidecar working directory
# =============================================================================


# -----------------------------------------------------------------------------
# GENERAL MODEL SETTINGS
# -----------------------------------------------------------------------------
general:
  # Directory where model .pkl and metadata .json will be stored
  model_dir: "./models"

  # Base name for KMeans model files
  model_name: "auth_kmeans_v1"

  # Global drift threshold for model retraining (p-value)
  drift_threshold: 0.05


# -----------------------------------------------------------------------------
# INGESTION SETTINGS (SPLUNK REST API)
# -----------------------------------------------------------------------------
ingestion:
  source_type: "splunk_rest"

  # Query for fetching authentication logs
  query: 'index = ml_sidecar sourcetype = ml:sidecar:json'


  # Time window for Splunk data ingestion
  earliest: "-90d"
  latest: "now"

  # Splunk REST API access details
  splunk:
    base_url: "<base-url>"

    # IMPORTANT:
    #   For production use:
    #       auth_token: "${SPLUNK_TOKEN}"
    #   Instead of storing the JWT directly inside the YAML.
    auth_token: <splunk bearer token for inputs>



# -----------------------------------------------------------------------------
# MODELING SETTINGS
# -----------------------------------------------------------------------------
modeling:
  algorithm: "kmeans"

  # Candidate K values used for silhouette-based selection
  k_candidates: [6, 8, 10, 12, 14]

  # Ensure reproducibility
  random_state: 42

  # Secondary drift threshold (training override)
  drift_threshold: 0.05


# -----------------------------------------------------------------------------
# OUTPUT SETTINGS
# -----------------------------------------------------------------------------
output:
  # Only exporting to KVStore in this configuration
  writers:
    - "splunk_kvstore"

  # Splunk KVStore export configuration
  splunk_kvstore:
    enabled: true

    base_url: "<base-url>"

    # Again — recommend using environment variables in production. 
    # Note : This Splunk can be different from ingestion.splunk.auth_token
    auth_token: <splunk bearer token for results>

    # Splunk App Name that contains the KVStore collections
    app: "ml_sidecar_app"

    # The specific collection to write
    collection: "auth_clusters"