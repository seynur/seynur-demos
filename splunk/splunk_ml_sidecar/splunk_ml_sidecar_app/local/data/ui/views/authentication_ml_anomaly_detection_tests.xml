
<dashboard version="2" theme="dark">
    <label>Authentication ML Anomaly Detection Test</label>
    <description></description>
    <definition><![CDATA[
{
	"title": "Authentication ML Anomaly Detection Test",
	"description": "",
	"inputs": {
		"input_global_time": {
			"options": {
				"defaultValue": "0,",
				"token": "global_time"
			},
			"title": "Global Time Range",
			"type": "input.timerange",
			"containerOptions": {
				"visibility": {}
			}
		},
		"input_users": {
			"options": {
				"items": [
					{
						"label": "All",
						"value": "*"
					}
				],
				"token": "input_users",
				"defaultValue": "*"
			},
			"title": "Users",
			"type": "input.dropdown",
			"dataSources": {
				"primary": "ds_zqvIRHbx"
			}
		},
		"input_clusters": {
			"options": {
				"items": [
					{
						"label": "All",
						"value": "*"
					}
				],
				"defaultValue": "*",
				"token": "input_clusters"
			},
			"title": "Clusters",
			"type": "input.dropdown",
			"dataSources": {
				"primary": "ds_JOP24UuG"
			}
		},
		"input_anomaly_score": {
			"options": {
				"defaultValue": 0,
				"token": "input_anomaly_score"
			},
			"title": "Anomaly Score",
			"type": "input.number"
		}
	},
	"defaults": {
		"dataSources": {
			"ds.search": {
				"options": {
					"queryParameters": {
						"earliest": "$global_time.earliest$",
						"latest": "$global_time.latest$"
					}
				}
			}
		}
	},
	"visualizations": {
		"viz_yePQ6tpv": {
			"type": "splunk.line",
			"dataSources": {
				"primary": "ds_RJU0olvV"
			},
			"title": "Timechart of Cluster Patterns with _time by drilldown",
			"description": "user = $input_users|s$, cluster= $input_clusters|s$, anomaly_score >= $input_anomaly_score$"
		},
		"viz_AxvXZPCY": {
			"type": "splunk.line",
			"dataSources": {
				"primary": "ds_Ua7fYi73"
			},
			"options": {
				"showLineSmoothing": true,
				"lineWidth": 3,
				"seriesColorsByField": {
					"0": "#53a051",
					"1": "#ef0000"
				},
				"overlayFields": []
			},
			"title": "Timechart of Outlier Patterns by drilldown",
			"description": "user = $input_users|s$, cluster= $input_clusters|s$, anomaly_score >= $input_anomaly_score$"
		},
		"viz_LNQIYvQn": {
			"type": "splunk.table",
			"dataSources": {
				"primary": "ds_vle0tiEf"
			},
			"title": "Table of User Behaviour Distribution by drilldown",
			"description": "user = $input_users|s$, cluster= $input_clusters|s$, anomaly_score >= $input_anomaly_score$"
		},
		"viz_alVmbo3j": {
			"type": "splunk.singlevalue",
			"dataSources": {
				"primary": "ds_hYACsyhJ"
			},
			"title": "Dominant Cluster ID",
			"options": {
				"sparklineDisplay": "off",
				"trendDisplay": "off"
			},
			"description": "user = $input_users|s$"
		},
		"viz_ph3YLkrM": {
			"type": "splunk.line",
			"dataSources": {
				"primary": "ds_a7BqMIOd"
			},
			"containerOptions": {
				"visibility": {}
			},
			"showProgressBar": false,
			"showLastUpdated": false,
			"title": "Timechart of Signature Frequency for drilldown",
			"options": {
				"nullValueDisplay": "connect"
			},
			"description": "user = $input_users|s$, cluster= $input_clusters|s$, anomaly_score >= $input_anomaly_score$"
		},
		"viz_8DN1f1EQ": {
			"type": "splunk.pie",
			"dataSources": {
				"primary": "ds_n2JI4CgF"
			},
			"title": "Piechart of Cluster Distribution by drilldown",
			"containerOptions": {
				"visibility": {}
			},
			"showProgressBar": false,
			"showLastUpdated": false,
			"options": {
				"showDonutHole": true
			},
			"description": "user = $input_users|s$, cluster= $input_clusters|s$, anomaly_score >= $input_anomaly_score$"
		},
		"viz_tXQoW2XI": {
			"type": "splunk.column",
			"dataSources": {
				"primary": "ds_5YsN8DAM"
			},
			"containerOptions": {},
			"showProgressBar": false,
			"showLastUpdated": false,
			"description": "cluster= $input_clusters|s$",
			"title": "Histogram of Cluster ID"
		},
		"viz_ZS7dhe9o": {
			"type": "splunk.table",
			"options": {},
			"dataSources": {
				"primary": "ds_hS0IBnXQ"
			}
		},
		"viz_c4aWsg7s": {
			"type": "splunk.table",
			"dataSources": {
				"primary": "ds_NWBJkItD"
			},
			"options": {},
			"containerOptions": {},
			"showProgressBar": false,
			"showLastUpdated": false,
			"context": {}
		},
		"viz_R7V7pBMj": {
			"type": "splunk.bubble",
			"options": {
				"size": "> primary | seriesByName('avg_score')",
				"y": "> primary | seriesByName('cnt')",
				"x": "> primary | seriesByName('cluster_id')",
				"category": "> primary | seriesByName('avg_score')"
			},
			"dataSources": {
				"primary": "ds_le3dhgoS"
			},
			"containerOptions": {
				"visibility": {}
			},
			"showProgressBar": false,
			"showLastUpdated": false,
			"title": "Anomaly Distribution by Cluster"
		},
		"viz_L1bBJIpx": {
			"type": "splunk.table",
			"dataSources": {
				"primary": "ds_eERjXP4W"
			},
			"title": "Outlier Table (Risk Sorted)"
		},
		"viz_KpKwQmue": {
			"type": "splunk.area",
			"dataSources": {
				"primary": "ds_rqVtGJB5"
			},
			"title": "High-Risk Activity Timeline",
			"options": {},
			"context": {},
			"containerOptions": {},
			"showProgressBar": false,
			"showLastUpdated": false
		},
		"viz_URlTBoR7": {
			"type": "splunk.table",
			"dataSources": {
				"primary": "ds_p65wKPkn"
			},
			"title": "Shannon Entropy by cluster id and signature",
			"description": "Shannon Entropy: H = Σ (-p * log(p))  • p = signature rate in the cluster • log(p) → signature's uniqueness • p*log(p) → signature information rate"
		}
	},
	"dataSources": {
		"ds_zqvIRHbx": {
			"name": "User Authentication Profiles - Table search",
			"options": {
				"query": "| inputlookup auth_user_profiles_lookup\n| dedup user\n| fields user",
				"queryParameters": {
					"earliest": "0"
				},
				"enableSmartSources": true
			},
			"type": "ds.search"
		},
		"ds_JOP24UuG": {
			"type": "ds.search",
			"options": {
				"query": "| inputlookup auth_cluster_profiles_lookup\n| dedup cluster_id\n| fields cluster_id"
			},
			"name": "User Authentication Cluster Profiles - Table search"
		},
		"ds_RJU0olvV": {
			"type": "ds.chain",
			"options": {
				"query": "| timechart count by cluster_id",
				"extend": "ds_dDKirreU",
				"enableSmartSources": true
			},
			"name": "Chain AEL - timechart by cluster_id"
		},
		"ds_n2JI4CgF": {
			"type": "ds.chain",
			"options": {
				"query": "| stats count BY cluster_id\n\n",
				"extend": "ds_dDKirreU",
				"enableSmartSources": true
			},
			"name": "Chain AEL - count by cluster_id"
		},
		"ds_hYACsyhJ": {
			"type": "ds.chain",
			"options": {
				"query": "| search user = $input_users|s$\n| stats count by dominant_cluster\n| sort - count\n| head 1\n| fields dominant_cluster",
				"extend": "ds_a4HJ8KmC"
			},
			"name": "Chain with AUPL - head 1 by dominant_cluster SPL"
		},
		"ds_a4HJ8KmC": {
			"type": "ds.search",
			"options": {
				"query": "| inputlookup auth_user_profiles_lookup"
			},
			"name": "Generic AUPL - Base Lookup SPL"
		},
		"ds_Ua7fYi73": {
			"type": "ds.chain",
			"options": {
				"query": "| timechart count by behavior_outlier",
				"extend": "ds_dDKirreU"
			},
			"name": "Chain with AEL - count by behaviour_outlier SPL"
		},
		"ds_vle0tiEf": {
			"type": "ds.chain",
			"options": {
				"query": "| eval src_and_dest = mvzip(src, dest, \" - \")\n| stats values(action) as actions, count as behavior_outlier_count, values(signature_id) as signature_ids,  count(src_and_dest) as src_and_dest_count, count(src) as src_count, count(dest) as dest_count by user, behavior_outlier\n| eventstats sum(behavior_outlier_count) as count by user\n| eval behaviour_rate=round(behavior_outlier_count/count, 4)",
				"extend": "ds_dDKirreU"
			},
			"name": "Chain wth AEL - count by user and behaviour_outlier SPL"
		},
		"ds_5gZUo0Iz": {
			"type": "ds.search",
			"options": {
				"query": "| inputlookup auth_cluster_profiles_lookup\n| search cluster_id=$input_clusters$"
			},
			"name": "Generic ACPL - Base Lookup SPL"
		},
		"ds_5YsN8DAM": {
			"type": "ds.chain",
			"options": {
				"extend": "ds_5gZUo0Iz",
				"query": "| table cluster_id, event_count"
			},
			"name": "Chain with ACPL - Total Event Count by cluster id"
		},
		"ds_a7BqMIOd": {
			"type": "ds.chain",
			"options": {
				"extend": "ds_dDKirreU",
				"query": "| timechart count by signature_id"
			},
			"name": "Chain with Base - count by signature_id"
		},
		"ds_hS0IBnXQ": {
			"type": "ds.chain",
			"options": {
				"query": "| fields - _key, label",
				"extend": "ds_5gZUo0Iz"
			},
			"name": "Chain ACPL - cluster information table"
		},
		"ds_NWBJkItD": {
			"type": "ds.chain",
			"options": {
				"query": "| search cluster_id=$input_clusters$ \n| stats count BY signature action",
				"extend": "ds_dDKirreU"
			},
			"name": "Chain with AEL - signature distribution"
		},
		"ds_clM5BmnW": {
			"type": "ds.search",
			"options": {
				"query": "| inputlookup auth_events_lookup",
				"queryParameters": {}
			},
			"name": "Generic AEL - Base SPL"
		},
		"ds_fsq4mujJ": {
			"type": "ds.search",
			"options": {
				"query": "index = ml_sidecar sourcetype = ml:sidecar:json earliest=$global_time.earliest|s$ latest=$global_time.latest|s$ user=$input_users|s$ \n| join user TimeCreated\n    [| inputlookup auth_events_lookup]"
			},
			"name": "Generic Base  - SPL"
		},
		"ds_dDKirreU": {
			"type": "ds.chain",
			"options": {
				"query": "| search cluster_id=$input_clusters|s$\n| where final_anomaly_score>=$input_anomaly_score|s$\n| join user\n    [| inputlookup auth_user_profiles_lookup]\n| join cluster_id\n    [| inputlookup auth_cluster_profiles_lookup]",
				"extend": "ds_fsq4mujJ"
			},
			"name": "Chain Generic Base - SPL"
		},
		"ds_p65wKPkn": {
			"type": "ds.chain",
			"options": {
				"query": "| search cluster_id = $input_clusters$\n| stats count BY signature cluster_id\n| eventstats sum(count) AS total by cluster_id\n| eval p=count/total, log_p = -1 * p * log(p)\n| eventstats sum(log_p) AS entropy by signature cluster_id\n| sort cluster_id, entropy",
				"extend": "ds_clM5BmnW"
			},
			"name": "Chain with AEL - signature entropy"
		},
		"ds_le3dhgoS": {
			"type": "ds.chain",
			"options": {
				"query": "| search final_anomaly_score > $input_anomaly_score$ user=$input_users|s$\n| stats avg(final_anomaly_score) AS avg_score count AS cnt BY cluster_id\n| eval avg_score = round(avg_score, 5)",
				"extend": "ds_clM5BmnW"
			},
			"name": "Chain with AEL - cluster anomaly distribution by user"
		},
		"ds_eERjXP4W": {
			"type": "ds.chain",
			"options": {
				"query": "| search final_anomaly_score > $input_anomaly_score$ user=\"$input_users$\"\n| eval _time=strptime(TimeCreated,\"%Y-%m-%dT%H:%M:%S.%QZ\")\n| table _time user src dest signature cluster_id final_anomaly_score behavior_outlier\n| sort - final_anomaly_score",
				"extend": "ds_clM5BmnW"
			},
			"name": "Chain with AEL - anomaly table"
		},
		"ds_rqVtGJB5": {
			"type": "ds.chain",
			"options": {
				"query": "| search final_anomaly_score>0.7 user=\"$input_users$\"\n| eval _time=strptime(TimeCreated,\"%Y-%m-%dT%H:%M:%S.%QZ\")\n| timechart span=1h count BY user",
				"extend": "ds_clM5BmnW"
			},
			"name": "Chain with AEL - high-risk activity by user"
		}
	},
	"layout": {
		"globalInputs": [
			"input_global_time",
			"input_users",
			"input_clusters",
			"input_anomaly_score"
		],
		"layoutDefinitions": {
			"layout_1": {
				"options": {
					"height": 960,
					"width": 1440
				},
				"structure": [
					{
						"item": "viz_yePQ6tpv",
						"type": "block",
						"position": {
							"x": 0,
							"y": 0,
							"w": 932,
							"h": 393
						}
					},
					{
						"item": "viz_AxvXZPCY",
						"type": "block",
						"position": {
							"x": 0,
							"y": 393,
							"w": 720,
							"h": 357
						}
					},
					{
						"item": "viz_ph3YLkrM",
						"type": "block",
						"position": {
							"x": 0,
							"y": 750,
							"w": 1440,
							"h": 335
						}
					},
					{
						"item": "viz_LNQIYvQn",
						"type": "block",
						"position": {
							"x": 720,
							"y": 393,
							"w": 720,
							"h": 357
						}
					},
					{
						"item": "viz_8DN1f1EQ",
						"type": "block",
						"position": {
							"x": 932,
							"y": 0,
							"w": 310,
							"h": 393
						}
					},
					{
						"item": "viz_alVmbo3j",
						"type": "block",
						"position": {
							"x": 1242,
							"y": 0,
							"w": 198,
							"h": 393
						}
					}
				],
				"type": "grid"
			},
			"layout_DB39wyo2": {
				"type": "grid",
				"structure": [
					{
						"item": "viz_tXQoW2XI",
						"type": "block",
						"position": {
							"x": 0,
							"y": 0,
							"w": 1200,
							"h": 400
						}
					},
					{
						"item": "viz_ZS7dhe9o",
						"type": "block",
						"position": {
							"x": 0,
							"y": 400,
							"w": 1200,
							"h": 400
						}
					},
					{
						"item": "viz_c4aWsg7s",
						"type": "block",
						"position": {
							"x": 0,
							"y": 800,
							"w": 1200,
							"h": 400
						}
					},
					{
						"item": "viz_URlTBoR7",
						"type": "block",
						"position": {
							"x": 0,
							"y": 1200,
							"w": 1200,
							"h": 400
						}
					}
				]
			},
			"layout_ru9Jdyau": {
				"type": "grid",
				"structure": [
					{
						"item": "viz_R7V7pBMj",
						"type": "block",
						"position": {
							"x": 0,
							"y": 0,
							"w": 1200,
							"h": 400
						}
					},
					{
						"item": "viz_L1bBJIpx",
						"type": "block",
						"position": {
							"x": 0,
							"y": 400,
							"w": 1200,
							"h": 400
						}
					},
					{
						"item": "viz_KpKwQmue",
						"type": "block",
						"position": {
							"x": 0,
							"y": 800,
							"w": 1200,
							"h": 400
						}
					}
				]
			}
		},
		"options": {},
		"tabs": {
			"items": [
				{
					"label": "USER BEHAVIOR OVERVIEW PANEL",
					"layoutId": "layout_1"
				},
				{
					"layoutId": "layout_DB39wyo2",
					"label": "CLUSTER ANALYTICS PANEL"
				},
				{
					"layoutId": "layout_ru9Jdyau",
					"label": "ANOMALY EXPLORER PANEL"
				}
			]
		}
	}
}
    ]]></definition>
    <meta type="hiddenElements"><![CDATA[
{
	"hideEdit": false,
	"hideOpenInSearch": false,
	"hideExport": false
}
    ]]></meta>
</dashboard>